<!DOCTYPE html><html><head><meta charset="utf-8"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="yes" name="apple-touch-fullscreen"><meta content="telephone=no,email=no" name="format-detection"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Rubik" rel="stylesheet"><script src="https://use.fontawesome.com/adaf0e149c.js"></script><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.6.0/styles/monokai_sublime.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" href="/css/markdown-github.css"><title>林水溶的博客</title><script src="/js/googleAnalytics.js"></script></head><body><div id="postContainer"><div id="postTop"><h4 id="logo">Life Is Short</h4><br><br><h2 id="postTitle">Flask/部署/Heroku 目前应该是相关方向上最详细的一篇总结</h2><br><span aria-hidden="true" class="postTime fa fa-calendar">2016-9-4</span><span aria-hidden="true" class="postTags fa fa-tags">&nbsp;Flask</span><span aria-hidden="true" class="postTags fa fa-tags">&nbsp;Heroku</span><span aria-hidden="true" class="postTags fa fa-tags">&nbsp;部署</span><br><br></div><section id="articleDiv"><p><p>﻿</p></p>
<p><p>本文首发于<a href="http://cocode.cc/t/flasky-heroku/6589" target="_blank" rel="external">CoCode社区</a><br><strong>写在前面</strong></p></p>
<ul><br><li>看的书是《Flask Web 开发》</li><br><li>win7 64bit 系统。</li><br><li>有些东西需要科学上网，[正好前几天为我弟弟普及了下科学上网]</li><br></ul><br><p>(<a href="http://pan.baidu.com/s/1qYVFeMw" target="_blank" rel="external">http://pan.baidu.com/s/1qYVFeMw</a>)</p><br><ul><br><li>从开始部署到成功，花了我3、4天。期间尝试过SAE（不知去查），没成。</li><br><li>这几天里，我部署了有十几次。（这十几次的意思是，从17c开始，重来。</li><br></ul><br><p>）</p><br><ul><br><li>我把论坛里用关键词 “flask 部署” 搜出来的部署在heroku上的文章反复看了不知道几遍了。反正</li><br></ul><br><p>烂熟了。所以发现了一些他们各自的问题。</p><br><ul><br><li>所以，这次总结我不打算再像其他人一样从开始写了（你可以小声的说宝宝懒）。下面我以三篇论坛</li><br></ul><br><p>里的帖子为例，说说如何部署在heroku上。</p><br><hr><br><ul><br><li>@guog  <a href="http://cocode.cc/t/first-update-heroku/3711" target="_blank" rel="external">把我点开先放一边</a></li><br><li>@Rain  <a href="http://cocode.cc/t/flask-heroku/4253" target="_blank" rel="external">把我点开先放一边</a></li><br></ul><br><hr><br><p><strong>正文预备</strong><br>宝宝心里苦啊，但是宝宝不说话。放一张漫画大家感受下：<br> <a href="http://www.cxyym.com/wp-content/uploads/2014/07/53_%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C.gif" target="_blank" rel="external">点我看漫画</a><br>西乔说到我心里去了。</p><br><p><strong>正文开始</strong><br> <em>来，我们看 @guog 的帖子。</em></p><br><p>1、2 我的坑是：</p><br><blockquote><br><p>然后全部copy到你的app目录下</p><br></blockquote><br><ul><br><li>前几次，我其实没有理解他的话，我的做法曾是：把从作者那里clone的flasky文件夹下的所有东西，</li><br></ul><br><p>全部copy到自己的文件夹下（就是从自己github上clone下来后的那个myapp文件夹）。</p><br><ul><br><li>这时注意：这两个文件夹下都有.git文件夹（这是个隐藏的文件夹，记得设置查看隐藏文件），我在</li><br></ul><br><p>copy时会出现：是否替换还是什么的。我选择的是全部替换。但错了。我要是都替换了。那 @guog 的这</p><br><p>么写的目的是啥。替换了还不如就在作者的文件夹（flasky）下操作呢。</p><br><ul><br><li>就这样，最后 run python manage.py deploy 时我遇到报错了，谷歌过…最后去stackoverflow上提</li><br></ul><br><p>问了：<br> <a href="https://stackoverflow.com/questions/37763278/how-to-chain-two-migrations-through-migraions-ids-and-to-create-a-linear-chain-t" target="_blank" rel="external">详情点这里</a>，《flask web 开发》的作者</p><br><p>回答了我的白痴问题（当然是现在这么觉得了，当时差点被搞死），觉得还是挺不好意思的。</p><br><ul><br><li>后来看了大神的在stackoverflow上的回答，看了他专门针对此问题写的文章。并按照文章中给的方法</li><br></ul><br><p>试这解决我这个 linear sequence 问题，但是没成功。后来灵光一闪，突然就知道问题出在哪了。</p><br><ul><br><li>看下上面，就是在copy作者flasky文件下的文件时，<strong>不要copy作者的.git 文件夹</strong>。README.md文</li><br></ul><br><p>件无所谓。</p><br><ul><br><li>至于requirements.txt文件，我曾用的是 pip freeze &gt; requirements.txt 得来的文件。但是，<strong>或</li><br></ul><br><p>许</strong>是因为一些模块版本原因导致的模块不兼容，在我成功 heroku run python manage.py deploy 并</p><br><p>成功访问网站后，出现不能成功确认用户（发送确认邮件后，点击邮件内URL，出来的页面仍然是你的账</p><br><p>户没有确认。用heroku logs 查看报错信息：typeerror ‘nonetype’ object has no attribute </p><br><p>‘<strong>getitem</strong>‘ ）</p><br><ul><br><li>这个问题，我google 了一番，看了几个stackoverflow上的回答。仍不能解决问题。因为我确认，相</li><br></ul><br><p>关代码并没有出现问题。（而且，本地测试一切正常）</p><br><ul><br><li>还是灵光一闪，（真的，骗人是小狗。）我想：可能是requirements.txt文件的原因。我就把 @guog </li><br></ul><br><p>帖子里的 文件内容copy到了我那个里面。ok,解决账户确认问题。</p><br><hr><br><p>3  步我的坑：</p><br><ul><br><li>推荐用 sina、或者 qq 的stmp 服务，gmail的我试过，没有搞定。对应的端口号你去搜吧。我用的</li><br></ul><br><p>sina, sina的是25。</p><br><ul><br><li>邮件抬头我没有改，我曾想改成中文的，却出现编码问题（因为急着网站上线，暂时不想去解决额外</li><br></ul><br><p>的问题。）</p><br><ul><br><li>管理员邮箱这么改：<br>FLASKY_MAIL_SENDER = “xxxxxxxx@xxxx.com” #不要留着尖括号和前面的英文。不信你本地测试下这</li><br></ul><br><p>两种。</p><br><hr><br><p>下面第二步的<br>4 的坑：</p><br><ul><br><li>或许你安装模块的时候，psycopg2 这个会最后会安装失败，这个时候，你把requirements.txt 文件</li><br></ul><br><p>里的psycopg2 先删掉，然后pip install -r requiremens.txt 然后，单独安装psycopy2 :pip install </p><br><p>psycopg2。最后再把psycopg2 加到requirements.txt文件里。</p><br><hr><br><p>6 的坑：</p><br><ul><br><li>打开data-dev.sqlite 文件（需要下载一个软件才能打开数据库文件：DB Browser for SQLite 官网</li><br></ul><br><p>下载去吧。需要科学上网。）<a href="http://cocode.cc/t/flasky-
heroku/6589" target="_blank" rel="external">这个位置有两张图，点我看</a><br>第一张那个看看有内容没，没得话新建记录，改成我那样。第二张，属性role_id那里值是NULL的话加上</p><br><p>。懂什么意思吧？</p><br><hr><br><p>下面第三步，我们看 @Rain 的帖子。</p><br><p>1 的说明：</p><br><ul><br><li><p>heroku 免费账户，最多只能存在5个app，想删除的话：</p><br><p> heroku apps<br> heroku apps:destroy your_app_name</p><br></li><br></ul><br><p>这几个命令是通过 heroku apps –h (或者heroku –h)学会的。</p><br><hr><br><p>4  的坑：</p><br><ul><br><li>至今我仍不懂论坛里不光是 @Rain ，还有其他人说的db.session.commit()<br>是什么意思。我曾把我 <strong>所有程序</strong> 里的db.session.add()后面都加上这个。但是报错了。</li><br></ul><br><p>indentation error:unexpected indent. 我又重来了一遍，这次没有所有的地方都加</p><br><p>db.session.commit()。</p><br><ul><br><li>现在我想想，大家讨论这个事情，大部分集中在15年12月份，说什么不是flask的问题，是heroku的坑</li><br></ul><br><p>。我想，或许当时是这样吧。但是现在貌似已经不存在那个问题了。所以， <strong>不要纠结论坛里那些人15</p><br><p>年12月份讨论的这个问题了</strong></p><br><ul><br><li>忽略4的这个添加。</li><br></ul><br><hr><br><p>5 ：</p><br><ul><br><li>我是win7 64bit，没看这一步在说啥。</li><br></ul><br><hr><br><p>部署过程的：<br>1 的坑：</p><br><ul><br><li>我曾在后面git push heroku master 时，报错：push rejected…..</li><br><li><a href="https://segmentfault.com/q/1010000005672524" target="_blank" rel="external">错误详情点我</a>，比较苦逼的是，在segmentfault </li><br></ul><br><p>上提的这个问题，他喵的还是我自己回答的。</p><br><ul><br><li>顺便一提，解决方法，我还是灵光一闪，想到的。（不骗人）</li><br><li>容我扯个淡：很久之前在知乎上看到这个问题，大概是：国内程序猿圈子有了stackoverflow，还有必<br>要存在像segmentfault这样的专注于中文的平台吗？</li><br><li>我觉得没有，因为对一个 <strong>程序猿</strong> 来说，能阅读英文的专业性文章（由词典，划词插件帮助也行</li><br></ul><br><p>）应该像科学上网是 <strong>标配</strong> 一样 是标配。否则，走不了多远吧。</p><br><ul><br><li>heroku上的帮助文档关于buildpacks,我也看了，最后解决方法看上面segmentfault链接。</li><br></ul><br><hr><br><p>2 的坑：</p><br><ul><br><li>其实在意初次建立数据库时，并不会看到 @Rain 说的看到像<br>HEROKU_POSTGRESQL_MAUVE_URL<br>这样的内容，而是一些像：<br>postgresql-xxxxx-xxxxx<br>这样的数据库名称。</li><br></ul><br><hr><br><p>4、5 步说明：</p><br><ul><br><li>我没试。直接略过了。</li><br></ul><br><hr><br><p>7 的说明：</p><br><ul><br><li>到这一步，就像 @Rain 说的，首先git status .检查一下，是不是所有改动都已提交到你的本地git </li><br></ul><br><p>仓库。</p><br><ul><br><li><p>PS：我说几个git 命令，你看你了解了吗。</p><br><p> git remote -v<br> git branch -v<br> git log –oneline –decorate<br> git add .<br> git commit -m “msg”<br> git log –pretty=format:”%h %s” –graph<br> git merge branch_name<br><a href="https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%85%B3%E4%BA
%8E%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6" target="_blank" rel="external">有一个不了解的就点我</a>  然后至少看到3.5再继续下面的。因为有好多问题就是</p><br></li><br></ul><br><p>git 本地仓库管理方面的问题。</p><br><ul><br><li>在进行下一步的 git push heroku master 时，会报错，其中的一些报错前面我已经说过了。但你还</li><br></ul><br><p>是有可能遇到一些我没提到的报错。这时： <strong>你要一行一行的认真看报错信息。提取关键信息，then </p><br><p>google it .</strong></p><br><hr><br><p>后来这几步，我也遇到了 报错。</p><br><ul><br><li>heroku logs </li><br><li>提取关键错误信息</li><br><li>google it </li><br></ul><br><hr><br><p><strong>写在后面的</strong></p><br><ul><br><li>Git 算是真的会了。（但是一些深层的不怎么用到的还是不会，不过不怕，用时再现学。）</li><br><li>flask app  部署在heroku过程中用到的命令是烂熟于心了。（十几遍啊，宝宝心里苦啊。）</li><br><li>以前学初Java时，没翻墙，用的是Bing。搜索报错信息时，往往遇到第一页，有好几个博客内容一模</li><br></ul><br><p>一样。当我点开一个又一个链接看到这情形，那叫一个难受啊。后来就受不了了，网上到处搜科学上网</p><br><p>方法。最终用上了google。<strong>那叫一个爽</strong> <strong>谁用谁知道</strong></p><br><ul><br><li>stackoverflow 对新手，小白挺友好的，但是你最好先善用google。</li><br></ul>
</section></div><script src="/js/jquery.min.js"></script><script src="/js/highlight.min.js"></script><script src="/js/start.js"></script></body></html>